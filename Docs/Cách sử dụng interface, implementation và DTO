 GIáº¢I THÃCH QUY Táº®C VÃ€NG - Interface & DTO Pattern
TÃ´i sáº½ giáº£i thÃ­ch 2 quy táº¯c vÃ ng nÃ y vá»›i vÃ­ dá»¥ trá»±c quan cho project TodoList cá»§a báº¡n. KHÃ”NG code vÃ o project - chá»‰ giáº£i thÃ­ch!
<hr></hr>
ğŸ“˜ QUY Táº®C #1: INTERFACE LÃ€ VUA
âŒ Váº¤N Äá»€ khi KHÃ”NG dÃ¹ng Interface (code hiá»‡n táº¡i cá»§a báº¡n):
// MainController.java - Code hiá»‡n táº¡i
@RestController
public class MainController {
    private final TaskRepo taskRepo;  // â† Phá»¥ thuá»™c trá»±c tiáº¿p vÃ o Repository

    public MainController(TaskRepo taskRepo) {
        this.taskRepo = taskRepo;
    }

    @PostMapping("/api/addTask")
    public void addTask(@RequestBody Task task) {
        taskRepo.save(task);  // â† Gá»i trá»±c tiáº¿p Repository
    }
}
Váº¥n Ä‘á»:
âš ï¸ Controller biáº¿t quÃ¡ nhiá»u - nÃ³ biáº¿t cáº£ Repository (database layer)
âš ï¸ KhÃ´ng cÃ³ business logic layer - khÃ´ng cÃ³ chá»— Ä‘á»ƒ xá»­ lÃ½ logic phá»©c táº¡p
âš ï¸ KhÃ³ test - pháº£i mock Repository (liÃªn quan Ä‘áº¿n DB)
âš ï¸ Tight coupling - thay Ä‘á»•i Repository áº£nh hÆ°á»Ÿng Controller
VÃ­ dá»¥ thá»±c táº¿:
Náº¿u mai sau báº¡n muá»‘n:
- ThÃªm validation trÆ°á»›c khi save
- ThÃªm logging
- ThÃªm caching
- Gá»­i email notification khi táº¡o task má»›i
- Kiá»ƒm tra quyá»n user

â†’ Báº N PHáº¢I Sá»¬A CONTROLLER!
â†’ Controller sáº½ phÃ¬nh to, khÃ³ maintain
<hr></hr>
âœ… GIáº¢I PHÃP: DÃ¹ng Interface (Service Layer)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÆ¯á»šC 1: Táº¡o SERVICE INTERFACE (contract)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
public interface TaskService {
    void createTask(CreateTaskRequest request);
    TaskDTO getTaskById(String id);
    List<TaskDTO> getAllTasks();
    // ... cÃ¡c methods khÃ¡c
}
// â†‘ Interface chá»‰ Ä‘á»‹nh nghÄ©a WHAT (lÃ m gÃ¬), khÃ´ng pháº£i HOW (lÃ m tháº¿ nÃ o)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÆ¯á»šC 2: Implementation (cÃ¡ch thá»±c hiá»‡n cá»¥ thá»ƒ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@Service
public class TaskServiceImpl implements TaskService {
    private final TaskRepo taskRepo;
    private final TaskMapper taskMapper;

    @Override
    public void createTask(CreateTaskRequest request) {
        // Business logic á»Ÿ Ä‘Ã¢y:
        // 1. Validation
        // 2. Map DTO â†’ Entity
        Task task = taskMapper.toEntity(request);
        // 3. Save
        taskRepo.save(task);
        // 4. Logging
        log.info("Task created: {}", task.getId());
        // 5. Gá»­i notification (náº¿u cáº§n)
        // ...
    }

    // ... implement cÃ¡c methods khÃ¡c
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BÆ¯á»šC 3: Controller chá»‰ biáº¿t INTERFACE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@RestController
public class MainController {
    private final TaskService taskService;  // â† Interface, KHÃ”NG pháº£i Impl!

    public MainController(TaskService taskService) {
        this.taskService = taskService;
    }

    @PostMapping("/api/tasks")
    public void createTask(@RequestBody CreateTaskRequest request) {
        taskService.createTask(request);  // â† Gá»i qua interface
    }
}
<hr></hr>
ğŸ¯ Lá»¢I ÃCH Cá»¦A INTERFACE:
1. Loose Coupling (Khá»›p lá»ng)
TRÆ¯á»šC (Tight Coupling):
Controller â†’ TaskRepo
    â†‘ Phá»¥ thuá»™c cháº·t

SAU (Loose Coupling):
Controller â†’ TaskService (interface) â†’ TaskServiceImpl â†’ TaskRepo
    â†‘               â†‘                        â†‘
    Chá»‰ biáº¿t    Contract              Implementation
    interface   (WHAT)                  (HOW)
2. Dá»… Thay Äá»•i Implementation
// Implementation 1: MongoDB
@Service("mongoTaskService")
public class MongoTaskServiceImpl implements TaskService {
    private final TaskRepo taskRepo;  // MongoDB

    @Override
    public void createTask(CreateTaskRequest request) {
        // Save vÃ o MongoDB
        taskRepo.save(...);
    }
}

// Implementation 2: PostgreSQL (tÆ°Æ¡ng lai)
@Service("postgresTaskService")
public class PostgresTaskServiceImpl implements TaskService {
    private final JpaTaskRepository jpaRepo;  // PostgreSQL

    @Override
    public void createTask(CreateTaskRequest request) {
        // Save vÃ o PostgreSQL
        jpaRepo.save(...);
    }
}

// Implementation 3: Cache Layer (decorator pattern)
@Service
public class CachedTaskServiceImpl implements TaskService {
    private final TaskService delegate;
    private final CacheManager cacheManager;

    @Override
    public void createTask(CreateTaskRequest request) {
        delegate.createTask(request);
        cacheManager.evict("tasks");  // Clear cache
    }
}

// Controller KHÃ”NG Cáº¦N THAY Äá»”I GÃŒ!
// Chá»‰ cáº§n config Spring Ä‘á»ƒ inject implementation khÃ¡c
3. Dá»… Test
// Unit Test cho Controller - KHÃ”NG cáº§n database!
@Test
public void testCreateTask() {
    // Mock interface
    TaskService mockService = mock(TaskService.class);
    MainController controller = new MainController(mockService);

    // Test
    CreateTaskRequest request = new CreateTaskRequest("Test", "...", false);
    controller.createTask(request);

    // Verify
    verify(mockService).createTask(request);
    // â†‘ KhÃ´ng cáº§n MongoDB, khÃ´ng cáº§n Spring Context!
}
<hr></hr>
ğŸ“˜ QUY Táº®C #2: DTO PATTERN
âŒ Váº¤N Äá»€ khi TRáº¢ ENTITY trá»±c tiáº¿p (code hiá»‡n táº¡i):
// Task.java - Entity (MongoDB Document)
@Document
public class Task {
    @Id
    private String id;
    private String title;
    private String description;
    private boolean completed;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // GIáº¢ Sá»¬ báº¡n thÃªm fields ná»™i bá»™ sau nÃ y:
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    private String userId;           // â† ThÃ´ng tin nháº¡y cáº£m
    private String internalNote;     // â† Ghi chÃº ná»™i bá»™
    private Date createdAt;          // â† Metadata
    private String createdByIP;      // â† ThÃ´ng tin audit
    private boolean deleted;         // â† Soft delete flag
}

// Controller tráº£ Entity trá»±c tiáº¿p
@GetMapping("/api/tasks/{id}")
public Task getTask(@PathVariable String id) {
    return taskRepo.findById(id).get();  // â† TRáº¢ ENTITY!
}
Response JSON (lá»™ Táº¤T Cáº¢ thÃ´ng tin):
{
  "id": "123",
  "title": "Mua sá»¯a",
  "description": "SiÃªu thá»‹ CoopMart",
  "completed": false,
  "userId": "user_456",              // â† Lá»˜ thÃ´ng tin user
  "internalNote": "VIP customer",    // â† Lá»˜ ghi chÃº ná»™i bá»™
  "createdAt": "2025-11-30T10:00:00",
  "createdByIP": "192.168.1.100",   // â† Lá»˜ IP
  "deleted": false                   // â† Lá»˜ implementation detail
}
Váº¥n Ä‘á» nghiÃªm trá»ng:
âš ï¸ 1. Báº£o máº­t:
- Lá»™ userId â†’ Hacker biáº¿t user nÃ o táº¡o task
- Lá»™ createdByIP â†’ Privacy issue
- Lá»™ internalNote â†’ ThÃ´ng tin bÃ­ máº­t cÃ´ng ty
âš ï¸ 2. API Breaking Changes:
Khi báº¡n thÃªm/xÃ³a/Ä‘á»•i tÃªn field trong Entity:
â†’ API response thay Ä‘á»•i
â†’ Frontend/Mobile app Bá»Š Lá»–I!
â†’ Pháº£i update táº¥t cáº£ clients
âš ï¸ 3. KhÃ´ng kiá»ƒm soÃ¡t Ä‘Æ°á»£c:
- Tráº£ vá» fields khÃ´ng cáº§n thiáº¿t (tá»‘n bandwidth)
- KhÃ´ng thá»ƒ custom format (vÃ­ dá»¥: date format)
- KhÃ´ng thá»ƒ thÃªm computed fields
<hr></hr>
âœ… GIáº¢I PHÃP: DÃ¹ng DTO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ENTITY - Ná»™i bá»™, chá»‰ dÃ¹ng trong Service & Repository
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@Document
public class Task {
    @Id
    private String id;
    private String title;
    private String description;
    private boolean completed;

    // Fields ná»™i bá»™ (KHÃ”NG lá»™ ra ngoÃ i)
    private String userId;
    private String internalNote;
    private Date createdAt;
    private String createdByIP;
    private boolean deleted;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DTO - Public API, CHá»ˆ chá»©a fields cáº§n thiáº¿t
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
public class TaskDTO {
    private String id;
    private String title;
    private String description;
    private boolean completed;

    // KHÃ”NG cÃ³ userId, internalNote, createdByIP, deleted
    // CHá»ˆ cÃ³ thÃ´ng tin cáº§n thiáº¿t cho client
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAPPER - Convert Entity â†” DTO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@Component
public class TaskMapper {
    public TaskDTO toDTO(Task entity) {
        return TaskDTO.builder()
            .id(entity.getId())
            .title(entity.getTitle())
            .description(entity.getDescription())
            .completed(entity.isCompleted())
            .build();
        // â†‘ Chá»‰ map fields public, Bá» fields ná»™i bá»™
    }

    public Task toEntity(CreateTaskRequest dto) {
        Task entity = new Task();
        entity.setTitle(dto.getTitle());
        entity.setDescription(dto.getDescription());
        entity.setCompleted(dto.isCompleted());
        // Set cÃ¡c fields ná»™i bá»™
        entity.setCreatedAt(new Date());
        entity.setDeleted(false);
        return entity;
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SERVICE - LÃ m viá»‡c vá»›i Entity, TRáº¢ DTO ra ngoÃ i
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@Service
public class TaskServiceImpl implements TaskService {
    private final TaskRepo taskRepo;
    private final TaskMapper taskMapper;

    @Override
    public TaskDTO getTaskById(String id) {
        Task entity = taskRepo.findById(id).get();  // â† Entity
        return taskMapper.toDTO(entity);            // â† Convert â†’ DTO
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTROLLER - CHá»ˆ biáº¿t DTO, KHÃ”NG biáº¿t Entity
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
@RestController
public class MainController {
    private final TaskService taskService;

    @GetMapping("/api/tasks/{id}")
    public TaskDTO getTask(@PathVariable String id) {
        return taskService.getTaskById(id);  // â† TRáº¢ DTO!
    }
}
Response JSON (an toÃ n, sáº¡ch sáº½):
{
  "id": "123",
  "title": "Mua sá»¯a",
  "description": "SiÃªu thá»‹ CoopMart",
  "completed": false
}
<hr></hr>
ğŸ¯ Lá»¢I ÃCH Cá»¦A DTO:
1. Báº£o máº­t & Kiá»ƒm soÃ¡t
ENTITY (internal):
- id âœ“
- title âœ“
- description âœ“
- completed âœ“
- userId âœ—        â† KHÃ”NG lá»™
- internalNote âœ—  â† KHÃ”NG lá»™
- createdByIP âœ—   â† KHÃ”NG lá»™
- deleted âœ—       â† KHÃ”NG lá»™

DTO (public):
- id âœ“
- title âœ“
- description âœ“
- completed âœ“

â†’ CHá»ˆ lá»™ thÃ´ng tin cáº§n thiáº¿t!
2. TÃ¡ch biá»‡t API khá»i Database Schema
Scenario 1: Äá»•i tÃªn field trong database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TRÆ¯á»šC: Task.title
SAU:   Task.taskTitle

âŒ KhÃ´ng dÃ¹ng DTO:
â†’ API response thay Ä‘á»•i {"taskTitle": "..."}
â†’ Frontend Bá»Š Lá»–I!

âœ… DÃ¹ng DTO:
â†’ Mapper sá»­a: entity.getTaskTitle() â†’ dto.setTitle()
â†’ API response KHÃ”NG Ä‘á»•i {"title": "..."}
â†’ Frontend VáºªN HOáº T Äá»˜NG!
Scenario 2: ThÃªm field má»›i trong database
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ThÃªm: Task.priority (int)

âŒ KhÃ´ng dÃ¹ng DTO:
â†’ API tá»± Ä‘á»™ng tráº£ thÃªm "priority": 0
â†’ Frontend cÃ³ thá»ƒ bá»‹ confuse

âœ… DÃ¹ng DTO:
â†’ KhÃ´ng thÃªm vÃ o DTO â†’ API khÃ´ng Ä‘á»•i
â†’ Hoáº·c thÃªm vÃ o DTO v2 â†’ API versioning
3. Different DTOs cho Different Use Cases
// DTO cho Response (GET)
public class TaskDTO {
    private String id;           // âœ“ CÃ³ id
    private String title;
    private String description;
    private boolean completed;
}

// DTO cho Create Request (POST)
public class CreateTaskRequest {
    // KHÃ”NG cÃ³ id!         // âœ— Server tá»± generate
    private String title;        // âœ“ Required
    private String description;  // âœ“ Optional
    private boolean completed;   // âœ“ Default false
}

// DTO cho Update Request (PUT)
public class UpdateTaskRequest {
    // KHÃ”NG cÃ³ id!         // âœ— Tá»« path param
    private String title;        // âœ“ Optional (null = khÃ´ng update)
    private String description;  // âœ“ Optional
    private Boolean completed;   // âœ“ Optional (Boolean wrapper, khÃ´ng pháº£i boolean)
}

// DTO cho List Response (GET /api/tasks)
public class TaskSummaryDTO {
    private String id;
    private String title;
    // KHÃ”NG cÃ³ description  // âœ— Giáº£m payload
    private boolean completed;
}
<hr></hr>
ğŸ—ï¸ KIáº¾N TRÃšC Tá»”NG QUAN
BEFORE (Code hiá»‡n táº¡i - KhÃ´ng tá»‘t):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT                               â”‚
â”‚                      (Postman/Frontend)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ HTTP Request
                            â†“ JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTROLLER                              â”‚
â”‚  - Nháº­n Task entity tá»« client                                â”‚
â”‚  - Gá»i trá»±c tiáº¿p Repository                                  â”‚
â”‚  - Tráº£ Task entity vá» client                                 â”‚
â”‚                                                              â”‚
â”‚  âš ï¸ Váº¥n Ä‘á»:                                                  â”‚
â”‚  - KhÃ´ng cÃ³ business logic layer                            â”‚
â”‚  - Lá»™ entity structure ra ngoÃ i                             â”‚
â”‚  - Tight coupling vá»›i Repository                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ Task entity
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REPOSITORY                              â”‚
â”‚  TaskRepo extends MongoRepository<Task, String>             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONGODB                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<hr></hr>
AFTER (Ãp dá»¥ng 2 quy táº¯c vÃ ng - Tá»‘t):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT                               â”‚
â”‚                      (Postman/Frontend)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ HTTP Request
                            â†“ CreateTaskRequest (DTO)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTROLLER                              â”‚
â”‚  - Nháº­n DTO tá»« client                                        â”‚
â”‚  - Gá»i TaskService (INTERFACE) â† QUY Táº®C #1                 â”‚
â”‚  - Tráº£ TaskDTO vá» client â† QUY Táº®C #2                       â”‚
â”‚                                                              â”‚
â”‚  âœ… Lá»£i Ã­ch:                                                 â”‚
â”‚  - ÄÆ¡n giáº£n, chá»‰ xá»­ lÃ½ HTTP                                 â”‚
â”‚  - KhÃ´ng biáº¿t Entity, chá»‰ biáº¿t DTO                          â”‚
â”‚  - Dá»… test (mock interface)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ DTO
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SERVICE INTERFACE (Contract)                   â”‚
â”‚  public interface TaskService {                             â”‚
â”‚      TaskDTO createTask(CreateTaskRequest request);         â”‚
â”‚      TaskDTO getTaskById(String id);                        â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  âœ… QUY Táº®C #1: Interface lÃ  vua                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ Implementation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             SERVICE IMPLEMENTATION (Business Logic)          â”‚
â”‚  @Service                                                    â”‚
â”‚  public class TaskServiceImpl implements TaskService {      â”‚
â”‚      private TaskRepo repo;                                 â”‚
â”‚      private TaskMapper mapper;                             â”‚
â”‚                                                              â”‚
â”‚      public TaskDTO createTask(CreateTaskRequest req) {     â”‚
â”‚          // 1. Validation                                   â”‚
â”‚          // 2. DTO â†’ Entity (qua Mapper)                    â”‚
â”‚          Task entity = mapper.toEntity(req);                â”‚
â”‚          // 3. Business logic                               â”‚
â”‚          // 4. Save to DB                                   â”‚
â”‚          Task saved = repo.save(entity);                    â”‚
â”‚          // 5. Entity â†’ DTO (qua Mapper)                    â”‚
â”‚          return mapper.toDTO(saved);  â† QUY Táº®C #2         â”‚
â”‚      }                                                       â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  âœ… Lá»£i Ã­ch:                                                â”‚
â”‚  - Chá»©a business logic                                      â”‚
â”‚  - Convert Entity â†” DTO                                     â”‚
â”‚  - CÃ³ thá»ƒ swap implementation                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ Entity (Task)
                            â†“ (Internal only)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MAPPER                                â”‚
â”‚  @Component                                                  â”‚
â”‚  public class TaskMapper {                                  â”‚
â”‚      TaskDTO toDTO(Task entity);        â† Entity â†’ DTO     â”‚
â”‚      Task toEntity(CreateTaskRequest);  â† DTO â†’ Entity     â”‚
â”‚  }                                                           â”‚
â”‚                                                              â”‚
â”‚  âœ… QUY Táº®C #2: KhÃ´ng lá»™ Entity ra ngoÃ i                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ Entity (Task)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REPOSITORY                              â”‚
â”‚  public interface TaskRepo                                  â”‚
â”‚      extends MongoRepository<Task, String> { }              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ BSON Document
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONGODB ATLAS                           â”‚
â”‚  Database: todolist_db                                      â”‚
â”‚  Collection: task                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<hr></hr>
ğŸ“Š SO SÃNH Cá»¤ THá»‚
Scenario: ThÃªm field "priority" vÃ o Task
âŒ KHÃ”NG dÃ¹ng Interface & DTO:
// BÆ°á»›c 1: ThÃªm field vÃ o Entity
@Document
public class Task {
    private String id;
    private String title;
    private int priority;  // â† THÃŠM Má»šI
}

// BÆ°á»›c 2: Controller tá»± Ä‘á»™ng tráº£ field má»›i
@GetMapping("/api/tasks/{id}")
public Task getTask(@PathVariable String id) {
    return taskRepo.findById(id).get();
    // â†’ Response: {"id":"123", "title":"...", "priority":0}
    //              â†‘ Field má»›i tá»± Ä‘á»™ng xuáº¥t hiá»‡n!
}

// âš ï¸ Káº¾T QUáº¢:
// - Frontend nháº­n thÃªm field "priority" KHÃ”NG MONG Äá»¢I
// - CÃ³ thá»ƒ gÃ¢y lá»—i náº¿u frontend strict type checking
// - API contract bá»‹ thay Ä‘á»•i mÃ  khÃ´ng thÃ´ng bÃ¡o
// - KhÃ´ng thá»ƒ kiá»ƒm soÃ¡t khi nÃ o expose field nÃ y
âœ… DÃ™NG Interface & DTO:
// BÆ°á»›c 1: ThÃªm field vÃ o Entity (internal)
@Document
public class Task {
    private String id;
    private String title;
    private int priority;  // â† THÃŠM Má»šI
}

// BÆ°á»›c 2: DTO KHÃ”NG Ä‘á»•i (API khÃ´ng Ä‘á»•i)
public class TaskDTO {
    private String id;
    private String title;
    // KHÃ”NG cÃ³ priority
}

// BÆ°á»›c 3: Service khÃ´ng Ä‘á»•i
@Service
public class TaskServiceImpl implements TaskService {
    public TaskDTO getTaskById(String id) {
        Task entity = repo.findById(id).get();
        return mapper.toDTO(entity);  // â† Chá»‰ map id, title
    }
}

// BÆ°á»›c 4: Controller khÃ´ng Ä‘á»•i
@GetMapping("/api/tasks/{id}")
public TaskDTO getTask(@PathVariable String id) {
    return taskService.getTaskById(id);
    // â†’ Response: {"id":"123", "title":"..."}
    //              â†‘ KHÃ”NG cÃ³ priority! API khÃ´ng Ä‘á»•i!
}

// âœ… Káº¾T QUáº¢:
// - API response KHÃ”NG Ä‘á»•i
// - Frontend VáºªN hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng
// - Khi muá»‘n expose priority â†’ Táº¡o TaskDTOv2
// - Kiá»ƒm soÃ¡t hoÃ n toÃ n API contract
<hr></hr>
ğŸ“ TÃ“M Táº®T - Tá»”NG Káº¾T
QUY Táº®C #1: INTERFACE LÃ€ VUA
WHY (Táº¡i sao)?
âœ… Loose coupling - dá»… thay Ä‘á»•i
âœ… Dá»… test - mock interface
âœ… TÃ¡ch biá»‡t concerns - Controller/Service/Repository
âœ… Flexibility - nhiá»u implementation

HOW (LÃ m tháº¿ nÃ o)?
1. Táº¡o Service Interface (contract)
2. Táº¡o Service Implementation (business logic)
3. Controller phá»¥ thuá»™c Interface, khÃ´ng pháº£i Implementation

WHEN (Khi nÃ o)?
â†’ LUÃ”N LUÃ”N! Trong má»i project cÃ³ business logic
QUY Táº®C #2: DTO PATTERN
WHY (Táº¡i sao)?
âœ… Báº£o máº­t - khÃ´ng lá»™ thÃ´ng tin ná»™i bá»™
âœ… API stability - thay Ä‘á»•i DB khÃ´ng áº£nh hÆ°á»Ÿng API
âœ… Kiá»ƒm soÃ¡t - chá»‰ expose fields cáº§n thiáº¿t
âœ… Flexibility - different DTOs cho different use cases

HOW (LÃ m tháº¿ nÃ o)?
1. Táº¡o DTO classes (Request & Response)
2. Táº¡o Mapper (Entity â†” DTO)
3. Service lÃ m viá»‡c vá»›i Entity, tráº£ DTO
4. Controller chá»‰ biáº¿t DTO, khÃ´ng biáº¿t Entity

WHEN (Khi nÃ o)?
â†’ LUÃ”N LUÃ”N! Trong má»i REST API public
<hr></hr>
ğŸ“š Káº¾T LUáº¬N
2 QUY Táº®C VÃ€NG nÃ y lÃ  FOUNDATION cá»§a Clean Architecture!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           KIáº¾N TRÃšC 3 Lá»šP (3-TIER)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PRESENTATION LAYER (Controller)                       â”‚
â”‚  - Xá»­ lÃ½ HTTP                                          â”‚
â”‚  - Validation input                                    â”‚
â”‚  - Chá»‰ biáº¿t DTO & Interface                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  BUSINESS LAYER (Service)                              â”‚
â”‚  - Business logic                                      â”‚
â”‚  - Transaction management                              â”‚
â”‚  - Convert Entity â†” DTO                               â”‚
â”‚  - LÃ m viá»‡c vá»›i Repository qua Interface              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DATA ACCESS LAYER (Repository)                        â”‚
â”‚  - CRUD operations                                     â”‚
â”‚  - Query database                                      â”‚
â”‚  - LÃ m viá»‡c vá»›i Entity                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

NGUYÃŠN Táº®C:
â†’ Má»—i layer CHá»ˆ giao tiáº¿p vá»›i layer liá»n ká»
â†’ DÃ¹ng Interface Ä‘á»ƒ tÃ¡ch biá»‡t
â†’ DÃ¹ng DTO Ä‘á»ƒ tÃ¡ch biá»‡t API khá»i DB
<hr></hr>
Báº¡n Ä‘Ã£ hiá»ƒu rÃµ 2 quy táº¯c vÃ ng nÃ y chÆ°a? CÃ³ cÃ¢u há»i nÃ o vá» pháº§n nÃ o khÃ´ng? ğŸ˜Š